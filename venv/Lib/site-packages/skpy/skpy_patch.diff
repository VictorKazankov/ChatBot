# Без патча при опросе прошлых сообщений в чате будет бить ошибку 'NoneType' object is not iterable при попытке анализа кнопок в сообщении, где их нет.
--- oldmsg.py	2020-10-28 22:52:30.000000000 +0200
+++ msg.py	2020-12-25 14:34:01.041647796 +0200
@@ -484,8 +484,9 @@
         data = json.loads(base64.b64decode(swiftTag.get("b64")))
         card = data.get("attachments", [{}])[0].get("content", {})
         fields.update({"title": card.get("title"),
-                       "body": card.get("text"),
-                       "buttons": [cls.Button(**button) for button in card.get("buttons")]})
+                       "body": card.get("text")})
+        if card.get("buttons"):
+            fields.update({"buttons": [cls.Button(**button) for button in card.get("buttons")]})
         return fields
 
     @property

# Без патча не может добавлять/удалять Альфа из чатов. в skpy захардкожен префикс '8:'(человек), патч меняет его на '28:'(бот) для АЛЬФа всех стейджей
--- oldchat.py	2020-10-28 22:52:30.000000000 +0200
+++ chat.py	2020-12-25 22:49:54.524810996 +0200
@@ -1,4 +1,5 @@
 from datetime import datetime
+from datetime import datetime
 import re
 import time
 
@@ -415,7 +415,7 @@
             id (str): user identifier to invite
             admin (bool): whether the user will gain admin privileges
         """
-        self.skype.conn("PUT", "{0}/threads/{1}/members/8:{2}".format(self.skype.conn.msgsHost, self.id, id),
+        self.skype.conn("PUT", "{0}/threads/{1}/members/{2}{3}".format(self.skype.conn.msgsHost, self.id, get_prefix(id), id),
                         auth=SkypeConnection.Auth.RegToken, json={"role": "Admin" if admin else "User"})
         if id not in self.userIds:
             self.userIds.append(id)
@@ -431,7 +431,7 @@
         Args:
             id (str): user identifier to remove
         """
-        self.skype.conn("DELETE", "{0}/threads/{1}/members/8:{2}".format(self.skype.conn.msgsHost, self.id, id),
+        self.skype.conn("DELETE", "{0}/threads/{1}/members/{2}{3}".format(self.skype.conn.msgsHost, self.id, get_prefix(id), id),
                         auth=SkypeConnection.Auth.RegToken)
         if id in self.userIds:
             self.userIds.remove(id)
@@ -510,7 +510,7 @@
         for id in members:
             if id == self.skype.userId:
                 continue
-            memberObjs.append({"id": "8:{0}".format(id), "role": "Admin" if id in admins else "User"})
+            memberObjs.append({"id": "{0}{1}".format(get_prefix(id), id), "role": "Admin" if id in admins else "User"})
         resp = self.skype.conn("POST", "{0}/threads".format(self.skype.conn.msgsHost),
                                auth=SkypeConnection.Auth.RegToken, json={"members": memberObjs})
         return self.chat(resp.headers["Location"].rsplit("/", 1)[1])
@@ -533,3 +533,8 @@
         return {"id": json.get("Resource"),
                 "long": json.get("Id"),
                 "blob": json.get("ChatBlob")}
+
+def get_prefix(id):
+    if id in ('4616742d-0abe-4a74-a951-ae547424add6', 'a071ecd4-0239-4a5f-83a6-c8e7022949d0', 'e88dea34-7c06-41d4-a7cb-a30de1d12236'): #dev-rc-prod id of ALF
+        return '28:' # prefix for bot users
+    else: return '8:'


# Без этого при поиске сильно закопанного диалога, мы срежемся на одном из них с 403 ошибкой.
--- oldconn.py	2021-01-10 15:32:51.632268778 +0200
+++ conn.py	2021-01-10 15:32:59.447978406 +0200
@@ -188,7 +188,7 @@
             return method(*args, **kwargs)
         return MethodType(inner, self)
 
-    def __call__(self, method, url, codes=(200, 201, 202, 204, 207), auth=None, headers=None, **kwargs):
+    def __call__(self, method, url, codes=(200, 201, 202, 204, 207, 403), auth=None, headers=None, **kwargs):
         """
         Make an API call.  Most parameters are passed directly to :mod:`requests`.
 
